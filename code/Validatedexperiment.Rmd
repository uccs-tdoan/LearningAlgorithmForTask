---
title: "LearningAlgorithm For data mining Task"
author: "TriDoan"
date: "Sunday, August 23, 2015"
output: html_document
---

Prepare to load corpus data 

```{r}
setwd("C:/aclImdb")
library(tm)

df_pos <- Corpus(DirSource("./train/pos"), readerControl = list(language = "en"))
df_neg <- Corpus(DirSource("./train/neg"),readerControl = list(language = "en"))
df <- c(df_pos, df_neg, recursive = T)

meta(df[[1]])
ids <- sapply( 1 : length(df), function(x) meta(df[[x]], "id"))

head(ids)
scores <- as.numeric(sapply(ids, function(x) sub("[0-9]+_([0-9]+)\\.txt", "\\1", x)))
scores <- factor(ifelse(scores >= 5, "positive", "negative"))

df <- tm_map(df, content_transformer(removeNumbers))
df <- tm_map(df, content_transformer(removePunctuation))
df <- tm_map(df, content_transformer(tolower))
df <- tm_map(df, content_transformer(removeWords), stopwords("english"))
df <- tm_map(df, content_transformer(stripWhitespace))

df <- DocumentTermMatrix(df)
df <- removeSparseTerms(x = df, sparse = 0.99)

dim(df)
inspect(df[10:16, 1:6])


df <- weightBin(df)




```
Convert into data frame

```{r}
 df <- as.data.frame(as.matrix(df))
```
Load library
```{r}
library(caret)
library(e1071)
set.seed(12345)

```
Create train and test set

```{r}
Idx <- createDataPartition(scores, p = 0.80, list = FALSE)
df_train <- df[Idx,]
df_test <- df[-Idx,]


scores_train = scores[Idx]
scores_test = scores[-Idx]

df_train <-  as.data.frame(df_train)

df_train$class <- scores_train

```

Without further preprocessing data, using Naive Bayes we can achieve

accuracy =  0.8158

```{r}

nb_model <- naiveBayes(df_train, scores_train)
nb_train_predictions <- predict(nb_model, df_train)

nb_test_predictions <- predict(nb_model, df_test)
mean(nb_test_predictions == scores_test)

```
Now we check other model

1. Random Forest
accuracy = 0.834

```{r}
library("randomForest")

rf<- randomForest(df_train, scores_train)

rf_test_prediction <- predict(rf, df_test, type="class")
mean(rf_test_prediction == scores_test)
```

2. SVM

accuracy = 0.8578
```{r}

library(e1071)
SVM_model <- svm(df_train, scores_train,type='C',kernel='radial',probability = FALSE)

SVM_test_prediction <- predict(SVM_model, df_test,type="class")
mean(SVM_test_prediction == scores_test)

```
3. Multivariate Adaptive Regression Splines

accuracy = 0.8188

```{r}
library(earth)

mars_model <-  earth(df_train, scores_train)
mars_test_prediction <- predict(mars_model, df_test,type="class")
mean(mars_test_prediction == scores_test)
```
Boost tree with gbm

```{r}
library(gbm)
boost <- gbm(class~. , data=df_train, distribution = 'gaussian', 
             n.trees = 5000,   interaction.depth = 4)


```
 gradient boost m

```{r}
library(gbm)
gbm_model = gbm(class~., data= df_train,distribution="bernoulli",interaction.depth=3,shrinkage=0.005 ,cv.folds=10)

best.iter <- gbm.perf(GBM_model,method="cv")

train_pred <- predict.gbm(GBM_model,trainset,best.iter)
test_pred <- predict.gbm(GBM_model,testset,best.iter)
